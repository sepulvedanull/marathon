{"version":3,"sources":["../server/index.js"],"names":["app","index","require","debug","port","normalizePort","process","env","PORT","server","http","createServer","set","use","bodyParser","json","urlencoded","extended","express","static","path","join","__dirname","get","req","res","header","dataPath","params","year","race","fs","existsSync","status","send","data","sendFile","next","err","Error","locals","message","error","render","listen","on","onError","onListening","val","parseInt","isNaN","syscall","bind","code","console","exit","addr","address","log","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["import path from 'path'\nimport favicon from 'serve-favicon'\nimport logger from 'morgan'\nimport cookieParser from 'cookie-parser'\nimport bodyParser from 'body-parser'\nimport express from 'express'\nimport fs from 'fs'\nimport http from 'http'\n\nconst app = express();\nconst index = require('./routes/index');\nconst debug = require('debug')('myapp:server');\n\nconst port = normalizePort(process.env.PORT || '4000');\nconst server = http.createServer(app);\n\napp.set('port', port);\napp.set('view engine', 'pug');\n// app.use(favicon(path.join(__dirname, 'client', 'favicon.ico')));\napp.use(logger('dev'));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(express.static(path.join(__dirname, 'build')));\n\napp.use('/', index);\n\napp.get(\"/api/:year/:race\", (req, res) => {\n  res.header(\"Access-Control-Allow-Origin\", \"*\");\n  res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept\");\n\n  const dataPath = `./data-scraper/data/${req.params.year}/${\n    req.params.race\n    }.json`;\n\n  if (!fs.existsSync(dataPath)) {\n    res.status(422).send(\"Data file does not exist\");\n  } else {\n    const data = require(dataPath);\n    res.status(200).send(data);\n  }\n});\n\n\napp.get('/', function(req, res) {\n  res.sendFile(path.join(__dirname + '/build/index.html'));\n});\n\n// catch 404 and forward to error handler\napp.use(function(req, res, next) {\n  var err = new Error('Not Found');\n  err.status = 404;\n  next(err);\n});\n\n// error handler\napp.use(function(err, req, res, next) {\n  // set locals, only providing error in development\n  res.locals.message = err.message;\n  res.locals.error = req.app.get('env') === 'development' ? err : {};\n\n  // render the error page\n  res.status(err.status || 500);\n  res.render('error');\n});\n\n\n/**\n * Listen on provided port, on all network interfaces.\n */\nserver.listen(port);\nserver.on('error', onError);\nserver.on('listening', onListening);\n\n\n/**\n * Normalize a port into a number, string, or false.\n */\nfunction normalizePort(val) {\n  const port = parseInt(val, 10);\n\n  if (isNaN(port)) return val;\n  if (port >= 0) return port;\n\n  return false;\n}\n\n\n/**\n * Event listener for HTTP server \"error\" event.\n */\nfunction onError(error) {\n  if (error.syscall !== 'listen') throw error;\n\n  var bind = typeof port === 'string'\n    ? 'Pipe ' + port\n    : 'Port ' + port;\n\n  // handle specific listen errors with friendly messages\n  switch (error.code) {\n    case 'EACCES':\n      console.error(bind + ' requires elevated privileges');\n      process.exit(1);\n      break;\n    case 'EADDRINUSE':\n      console.error(bind + ' is already in use');\n      process.exit(1);\n      break;\n    default:\n      throw error;\n  }\n}\n\n\n/**\n * Event listener for HTTP server \"listening\" event.\n */\nfunction onListening() {\n  const addr = server.address();\n  const bind = typeof addr === 'string'\n    ? 'pipe ' + addr\n    : 'port ' + addr.port;\n  debug('Listening on ' + bind);\n  console.log(`server running on port ${addr.port}`);\n}\n\n\nmodule.exports = app;\n"]}